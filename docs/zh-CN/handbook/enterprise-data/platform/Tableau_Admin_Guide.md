# Tableau 管理员指南

GitLab 中的 Tableau

本页面描述了 GitLab 管理的 Tableau 站点的管理流程。本指南中将引用与这些流程相关的其他运行手册、脚本、工具和存储库。

## 站点

GitLab 目前维护三个不同的 Tableau 站点，用于不同的目的：

  * **主站点：** 主站点是所有工作簿和数据源开发的地方，团队成员可以申请使用许可证。

  * **公共站点：** 公共站点用于托管嵌入公共手册中的工作簿，供访问手册页面的任何人查看。团队成员无法直接访问公共站点，且该站点上不进行一般的工作簿开发。

  * **沙盒站点：** 沙盒站点用于在不影响主站点的情况下测试脚本和功能。该站点上不进行一般的工作簿开发。

### **其他站点**

Tableau Cloud Manager 是一项管理功能，允许每个账户创建最多三个额外的 Tableau 站点。这些额外的站点可用于各种目的，包括增强治理、新内容的暂存、功能测试或按项目或团队进行安全数据分离。通过 [Tableau Cloud Manager](https://help.tableau.com/current/online/en-us/cloud_manager_intro.htm)，管理员可以设置隔离且组织良好的工作空间，帮助维护数据完整性并确保跨不同环境的无缝管理。

## 工具

TableauConMan 工具是内部开发的，用于自动化 Tableau 管理的多个方面。通过 Airflow 中的编排和一系列称为计划的配置文件，它目前执行以下功能：

  * 将内容同步到公共站点
  * 管理主站点上的组和组成员资格

## 用户管理

  * **主站点：** 对于主站点，团队成员使用 Okta 登录。为了使团队成员能够在 Okta 中看到登录选项，他们必须被添加到 [`okta-tableau-users`](https://groups.google.com/a/gitlab.com/g/okta-tableau-users/members) Google 群组中。数据团队存储库中的规范文件用于审查和跟踪主站点上的用户更改。任何用户更改应首先在文件中进行并经过审查，然后按照用户 [运行手册](https://gitlab.com/gitlab-data/runbooks/-/tree/main/tableau?ref_type=heads) 中的适当说明在站点上进行更改。用户的组成员资格使用 TableauConMan 工具进行管理，详见组管理部分。

  * **公共站点：** 对于公共站点，用户直接登录，不使用 Okta。该站点上的非查看者许可证数量有限，因此任何站点上的主动管理都应使用分析服务账户进行。

  * **沙盒站点：** 对于沙盒站点，用户直接登录，不使用 Okta。该站点上的非查看者许可证数量有限，因此任何站点上的主动管理都应使用分析服务账户进行。

## 组管理

  * **主站点：** 对于主站点，组和组成员资格使用 TableauConMan 工具进行管理。要添加或删除组，应在数据团队存储库中的规范文件的 `groups` 部分进行适当的更改。要添加或删除组成员，应在特定用户的 `groups` 列表中添加或删除组名。更改经过审查并合并后，[`tableau_workbook_migrate`](https://gitlab.com/gitlab-data/analytics/-/blob/master/dags/general/tableau_workbook_migrate.py) DAG 中的 `tableau_provision_users` 任务将应用这些更改。

  * **公共站点：** 公共站点的组是手动维护的。可以按照组 [运行手册](https://gitlab.com/gitlab-data/runbooks/-/tree/main/tableau?ref_type=heads) 中的一般说明来修改组或组成员资格。

  * **沙盒站点：** 沙盒站点的组是手动维护的。可以按照组 [运行手册](https://gitlab.com/gitlab-data/runbooks/-/tree/main/tableau?ref_type=heads) 中的一般说明来修改组或组成员资格。

## Tableau Cloud 站点项目结构

  * **主站点：** 主站点的项目结构是手动维护的，应与 Tableau 存储库中的文件夹结构匹配。此结构用于强制执行生产项目中更改的代码审查，并且在站点上进行更改之前，应批准包含请求更改的 MR。

  * **公共站点：** 公共站点的项目结构是手动维护的。许多流程（如内容同步和可共享内容报告）依赖于站点的项目结构。更改项目结构时应考虑到这一点。

  * **沙盒站点：** 沙盒站点的项目结构不需要固定为任何特定结构。

## 内容权限

  * **主站点：** 主站点的内容权限是手动维护的，应与透明度价值观保持一致，仅在严格需要时限制对内容的访问。内容权限应仅授予组，而不是个别用户。

  * **公共站点：** 公共站点的内容权限是手动维护的。许多流程（如内容同步和可共享内容报告）依赖于站点的项目结构。更改项目结构时应考虑到这一点。

  * **沙盒站点：** 沙盒站点的内容权限不需要固定为任何特定结构。

## 内容管理

### 主站点

#### 陈旧和未使用的内容管理

#### 1\. 目的 - 内容归档

未使用的工作簿和数据源被移动到归档文件夹，以维护一个干净高效的 Tableau Cloud 环境。这是一个自动化过程，确保只有高质量、积极使用的内容保持易于访问，从而减少混乱并增强用户体验。用户可以快速找到并访问高质量、相关的内容，而无需筛选过时或未使用的项目。自动化此过程确保了一致性和准确性，节省了 Tableau 管理团队的时间和精力。手动干预被最小化，减少了错误的可能性。

#### 2\. 前提条件 - 自动化脚本

使用 Python 脚本进行此自动化，该脚本遵循特定标准来识别和归档陈旧内容。以下是陈旧内容识别的详细说明：

  1. **工作簿** \- 陈旧标准：如果工作簿在过去 90 天内未创建、更新或查看，则视为陈旧。

  2. **数据源** \- 陈旧标准：如果数据源没有连接的工作簿，并且在过去 90 天内未创建或更新，则视为未使用。

排除和唯一性：

    * 排除：带有 Tableau 标签“Do NOT Archive”的工作簿和数据源将被排除在归档之外。

    * 重命名以确保唯一性：在将工作簿或数据源移动到“Archive”文件夹之前，其名称将附加所有者、父项目和当前日期/时间，以确保唯一性并避免冲突。

#### 3\. 归档计划

此过程计划每季度运行一次，特别是在每个季度末。Tableau 管理团队将手动启动该过程，确保自动化在最合适的时间运行，并且可以解决任何即时问题。

#### 4\. 排除标签

为了防止关键内容被归档，业务可以使用排除标签“Do NOT Archive”。任何带有此标签的工作簿或数据源将在归档过程中被跳过。数据团队可能会定期审查带有此标签的仪表板，以确保例外情况仍然合理。应注意，带有“Public”标签的工作簿也应被排除。

#### 5\. 归档文件夹访问

“Archive”文件夹具有受限访问权限，这意味着业务无法直接查看或访问其内容。此限制有助于从搜索结果中删除已归档的内容，从而维护一个干净高效的环境。如果用户需要访问任何已归档的内容，他们可以通过 #data-tableau Slack 频道联系 BI 团队寻求帮助。

### 公共站点

#### 陈旧和未使用的内容管理

内容归档和管理是根据需要手动执行的。

### 沙盒站点

内容归档和管理是根据需要手动执行的。

## 连接应用程序

只有公共站点有一个连接应用程序，用于查看嵌入公共手册中的内容。此连接应用程序的密钥、秘密和 ID 必须更新并与手册团队共享：特别是用于在页面加载时验证查看者的 [云函数](https://console.cloud.google.com/functions/details/us-central1/tableau-connected-app?env=gen2&hl=en&project=mcottrell-8f2b9454&tab=details)。

## Tableau Cloud 和 Tableau Desktop 发布管理

我们的数据和